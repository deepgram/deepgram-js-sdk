<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Deepgram SDK Browser Test - transcribeUrl</title>
</head>

<body>
    <h1>Deepgram SDK Browser Test - transcribeUrl</h1>
    <div id="status">Loading...</div>
    <pre id="result"></pre>

    <script src="./deepgram-browser-bundle.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const resultEl = document.getElementById('result');

        async function runTest() {
            try {
                statusEl.textContent = 'Creating Deepgram client...';
                console.log('SDK loaded, creating client');

                // The bundle exposes DeepgramSDK globally
                const { DeepgramClient } = DeepgramSDK;

                const client = new DeepgramClient({
                    apiKey: '{{DEEPGRAM_API_KEY}}'
                });

                statusEl.textContent = 'Sending request...';
                console.log('Request sent');

                const response = await client.listen.v1.media.transcribeUrl({
                    url: 'https://dpgr.am/spacewalk.wav'
                }, {
                    model: 'nova-3'
                });

                statusEl.textContent = 'Response received!';
                console.log('Response received');

                const resultData = {
                    success: true,
                    hasResults: !!response?.results,
                    hasChannels: !!response?.results?.channels,
                    channelCount: response?.results?.channels?.length || 0,
                    firstTranscript: response?.results?.channels?.[0]?.alternatives?.[0]?.transcript || null
                };

                resultEl.textContent = JSON.stringify(resultData, null, 2);
                window.testResult = resultData;

            } catch (error) {
                statusEl.textContent = 'Error: ' + error.message;
                console.error('Error:', error);

                const errorData = {
                    success: false,
                    error: error.message,
                    stack: error.stack
                };

                resultEl.textContent = JSON.stringify(errorData, null, 2);
                window.testResult = errorData;
            }
        }

        runTest();
    </script>
</body>

</html>